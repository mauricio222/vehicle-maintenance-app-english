<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Debug Filters</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Debug Filter Issue</h1>

        <div class="row mb-4">
            <div class="col-md-4">
                <label for="filtroCategoria">Category</label>
                <select id="filtroCategoria" class="form-select">
                    <option value="">All categories</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="filtroTipo">Type</label>
                <select id="filtroTipo" class="form-select">
                    <option value="">All types</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="filtroMecanico">Mechanic</label>
                <select id="filtroMecanico" class="form-select">
                    <option value="">All mechanics</option>
                </select>
            </div>
        </div>

        <table id="tablaMantenimientos" class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Mileage</th>
                    <th>Category</th>
                    <th>Type</th>
                    <th>Mechanic</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <table id="tablaMantenimientosRepetidos" class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Mileage</th>
                    <th>Category</th>
                    <th>Type</th>
                    <th>Mechanic</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function() {
            console.log('Document ready');

            // Simulated backend data
            var categoriasUnicas = ['Engine', 'Brakes', 'Transmission'];
            var tiposUnicos = ['Oil Change', 'Brake Pads', 'Fluid Check'];
            var mecanicosUnicos = ['John Doe', 'Jane Smith'];

            // Sample data for tables
            var sampleData = [
                ['2024-01-01', '10000', 'Engine', 'Oil Change', 'John Doe'],
                ['2024-02-01', '12000', 'Brakes', 'Brake Pads', 'Jane Smith']
            ];

            console.log('Initializing first DataTable...');
            var tablaUltimos = $('#tablaMantenimientos').DataTable({
                data: sampleData,
                columns: [
                    { title: "Date" },
                    { title: "Mileage" },
                    { title: "Category" },
                    { title: "Type" },
                    { title: "Mechanic" }
                ]
            });
            console.log('First DataTable initialized');

            console.log('Initializing second DataTable...');
            var tablaRepetidos = $('#tablaMantenimientosRepetidos').DataTable({
                data: sampleData,
                columns: [
                    { title: "Date" },
                    { title: "Mileage" },
                    { title: "Category" },
                    { title: "Type" },
                    { title: "Mechanic" }
                ]
            });
            console.log('Second DataTable initialized');

            // Populate filters
            console.log('Populating filters...');
            function populateFilters() {
                // Category
                var categorySelect = $('#filtroCategoria');
                categorySelect.empty().append('<option value="">All categories</option>');
                categoriasUnicas.forEach(function(cat) {
                    categorySelect.append(new Option(cat, cat));
                });
                console.log('Category filter populated with', categoriasUnicas.length, 'options');

                // Type
                var typeSelect = $('#filtroTipo');
                typeSelect.empty().append('<option value="">All types</option>');
                tiposUnicos.forEach(function(type) {
                    typeSelect.append(new Option(type, type));
                });
                console.log('Type filter populated with', tiposUnicos.length, 'options');

                // Mechanic
                var mechanicSelect = $('#filtroMecanico');
                mechanicSelect.empty().append('<option value="">All mechanics</option>');
                mecanicosUnicos.forEach(function(mech) {
                    mechanicSelect.append(new Option(mech, mech));
                });
                console.log('Mechanic filter populated with', mecanicosUnicos.length, 'options');
            }

            populateFilters();

            console.log('Initializing Select2...');
            $('#filtroCategoria, #filtroTipo, #filtroMecanico').select2({
                width: '100%',
                placeholder: 'Select an option'
            });
            console.log('Select2 initialized');

            // Check filter contents after a delay
            setTimeout(function() {
                console.log('Checking filters after 2 seconds:');
                console.log('Category options:', $('#filtroCategoria option').length);
                console.log('Type options:', $('#filtroTipo option').length);
                console.log('Mechanic options:', $('#filtroMecanico option').length);

                if ($('#filtroCategoria option').length === 1) {
                    console.error('FILTERS HAVE BEEN CLEARED!');
                } else {
                    console.log('Filters are still populated correctly');
                }
            }, 2000);
        });
    </script>
</body>
</html>